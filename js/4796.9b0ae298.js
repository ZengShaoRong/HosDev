"use strict";(self["webpackChunkvue_arcgis_0905"]=self["webpackChunkvue_arcgis_0905"]||[]).push([[4796],{91354:function(e,t,a){a.d(t,{P:function(){return L},L:function(){return w}});var i=a(40399),n=a(13592),r=a(43735),s=a(38308),o=a(96140);class l{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(o.AU),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const t=new l,a=this._originStores[o.Gr.DEFAULTS];a&&a.forEach(((e,a)=>{t.set(a,(0,s.o8)(e),o.Gr.DEFAULTS)}));for(let i=o.Gr.SERVICE;i<o.AU;i++){const a=this._originStores[i];a&&a.forEach(((a,n)=>{e&&e.has(n)||t.set(n,(0,s.o8)(a),i)}))}return t}get(e,t){const a=void 0===t?this._values:this._originStores[t];return a?a.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?[...t.keys()]:[]}set(e,t,a=o.Gr.USER){let i=this._originStores[a];if(i||(i=new Map,this._originStores[a]=i),i.set(e,t),!this._values.has(e)||this._propertyOriginMap.get(e)<=a){const i=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,a),i!==t}return!1}delete(e,t=o.Gr.USER){const a=this._originStores[t];if(!a)return;const i=a.get(e);if(a.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let a=t-1;a>=0;a--){const t=this._originStores[a];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,a);break}}}return i}has(e,t){const a=void 0===t?this._values:this._originStores[t];return!!a&&a.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const a=this._originStores[t],i=a?.get(e),n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,t),n!==i}originOf(e){return this._propertyOriginMap.get(e)||o.Gr.DEFAULTS}forEach(e){this._values.forEach(e)}}var h=a(91607),u=a(22650),d=a(39834);const c=e=>{let t=class extends e{constructor(...e){super(...e);const t=(0,u.oY)(this),a=t.store,i=new l;t.store=i,(0,r.k)(t,a,i)}read(e,t){(0,h.L)(this,e,t)}getAtOrigin(e,t){const a=p(this),i=(0,o.aB)(t);if("string"==typeof e)return a.get(e,i);const n={};return e.forEach((e=>{n[e]=a.get(e,i)})),n}originOf(e){return(0,o.OL)(this.originIdOf(e))}originIdOf(e){return p(this).originOf(e)}revert(e,t){const a=p(this),i=(0,o.aB)(t),n=(0,u.oY)(this);let r;r="string"==typeof e?"*"===e?a.keys(i):[e]:e,r.forEach((e=>{n.invalidate(e),a.revert(e,i),n.commit(e)}))}};return t=(0,i._)([(0,d.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function p(e){return(0,u.oY)(e).store}let y=class extends(c(n.A)){};y=(0,i._)([(0,d.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],y);var g=a(2335),f=a(71016);const m=e=>{let t=class extends e{constructor(...e){super(...e)}clear(e,t="user"){return C(this).delete(e,(0,o.aB)(t))}write(e,t){return(0,f.M)(this,e=e||{},t),e}setAtOrigin(e,t,a){(0,u.oY)(this).setAtOrigin(e,t,(0,o.aB)(a))}removeOrigin(e){const t=C(this),a=(0,o.aB)(e),i=t.keys(a);for(const n of i)t.originOf(n)===a&&t.set(n,t.get(n,a),o.Gr.USER)}updateOrigin(e,t){const a=C(this),i=(0,o.aB)(t),n=(0,g.Jt)(this,e);for(let r=i+1;r<o.AU;++r)a.delete(e,r);a.set(e,n,i)}toJSON(e){return this.write({},e)}};return t=(0,i._)([(0,d.$)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function C(e){return(0,u.oY)(e).store}const L=e=>{let t=class extends(m(c(e))){constructor(...e){super(...e)}};return t=(0,i._)([(0,d.$)("esri.core.MultiOriginJSONSupport")],t),t};let w=class extends(L(n.A)){};w=(0,i._)([(0,d.$)("esri.core.MultiOriginJSONSupport")],w)},54971:function(e,t,a){a.d(t,{K:function(){return i}});const i=(e=>e)(["operational-layers","basemap","ground"])},23475:function(e,t,a){a.r(t),a.d(t,{default:function(){return Y}});a(44114),a(16573),a(78100),a(77936),a(17642),a(58004),a(33853),a(45876),a(32475),a(15024),a(31698),a(37467),a(44732),a(79577);var i,n=a(40399),r=(a(32334),a(81677)),s=a(18244),o=a(8660),l=a(71207),h=a(13570),u=a(36861),d=(a(9302),a(95753),a(39834)),c=a(81182),p=a(3234),y=a(46740);!function(e){e.MULTIPLIER="multiplier",e.ABSOLUTE="absoluteValue"}(i||(i={}));var g=a(53963),f=a(5182),m=a(69235),C=a(22528),L=a(60522),w=a(47771);let M,b=null;function k(){return M||(M=a.e(7124).then(a.bind(a,87124)).then((e=>e.l)).then((({default:e})=>e({locateFile:e=>(0,w.s)(`esri/libs/linkchartlayout/${e}`)}))).then((e=>{E(e)})),M)}function E(e){b=e}var v,T;function _(e,t,a,i,n,r){const s=a.length,o=n.length,l=Float64Array.BYTES_PER_ELEMENT,h=Uint32Array.BYTES_PER_ELEMENT,u=Uint8Array.BYTES_PER_ELEMENT,d=16,c=d+s*(u+2*l)+o*(2*h),p=b._malloc(c);try{const u=p+d-p%d,c=u+s*l,y=c+s*l,g=y+o*h,f=g+o*h,m=()=>[b.HEAPF64.subarray(u>>3,(u>>3)+s),b.HEAPF64.subarray(c>>3,(c>>3)+s),b.HEAPU32.subarray(y>>2,(y>>2)+o),b.HEAPU32.subarray(g>>2,(g>>2)+o),b.HEAPU8.subarray(f,f+s)],[C,L,w,M,k]=m();C.set(a),L.set(i),w.set(n),M.set(r),k.set(t);let E=e(s,f,u,c,o,y,g),v=null,T=null;if(E){const e=b.getLayoutLinksTypes(),t=b.getLayoutLinksVerticesEndIndices(),a=b.getLayoutLinksVertices(),i=b.countLayoutLinksVertices();!o||e&&t?i&&!a?E=!1:(v={types:new Uint8Array(b.HEAPU8.subarray(e,e+o)),vertexEndIndex:new Uint32Array(b.HEAPU32.subarray(t>>2,(t>>2)+o)),vertices:new Float64Array(b.HEAPF64.subarray(a>>3,(a>>3)+2*i))},T=b.getAuxiliaryGraphicElements()):E=!1}const[_,A,D,N,x]=m();return a.set(_),i.set(A),n.set(D),r.set(N),t.set(x),{success:E,links:v,graphics:T}}finally{b._free(p),b.cleanupLayout()}}!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"}(v||(v={})),function(e){e[e.Regular=0]="Regular",e[e.Orthogonal=1]="Orthogonal",e[e.Curved=2]="Curved",e[e.Recursive=3]="Recursive"}(T||(T={}));const A=2,D=1,N=-1;var x,R,I,S,O,P,G,U,Z;!function(e){function t(){return b.getMinIdealEdgeLength()}function a(e,t,a,i,n,r=A,s=D,o=N){return _(((e,t,a,i,n,l,h)=>b.applyForceDirectedLayout(e,t,a,i,n,l,h,r,s,o)),e,t,a,i,n)}e.getMinIdealEdgeLength=t,e.apply=a}(x||(x={})),function(e){function t(e,t,a,i,n,r=A,s=D,o=N){return _(((e,t,a,i,n,l,h)=>b.applyCommunityLayout(e,t,a,i,n,l,h,r,s,o)),e,t,a,i,n)}e.apply=t}(R||(R={})),function(e){function t(e,t,a,i,n){return _(b.applySimpleLayout,e,t,a,i,n)}e.apply=t}(I||(I={})),function(e){function t(e,t,a,i,n){return _(b.applyHierarchicalLayout,e,t,a,i,n)}e.apply=t}(S||(S={})),function(e){function t(e,t,a,i,n){return _(b.applyRadialTreeLayout,e,t,a,i,n)}e.apply=t}(O||(O={})),function(e){function t(e,t,a,i,n){return _(b.applySmartTreeLayout,e,t,a,i,n)}e.apply=t}(P||(P={})),function(e){function t(e,t,a,i,n,r,s,o,l){return _(((e,t,a,r,s,h,u)=>{if(i.length!==e)return!1;if(n.length!==e)return!1;if(o.length!==s)return!1;if(l.length!==s)return!1;const d=Float64Array.BYTES_PER_ELEMENT,c=16,p=b._malloc(c+e*d),y=b._malloc(c+e*d),g=b._malloc(c+s*d),f=b._malloc(c+s*d),m=p+c-p%c,C=y+c-y%c,L=g+c-g%c,w=f+c-f%c;try{return b.HEAPF64.subarray(m>>3,(m>>3)+e).set(i),b.HEAPF64.subarray(C>>3,(C>>3)+e).set(n),b.HEAPF64.subarray(L>>3,(L>>3)+s).set(o),b.HEAPF64.subarray(w>>3,(w>>3)+s).set(l),b.applyChronologicalLayout(e,t,a,r,m,C,s,h,u,L,w)}finally{b._free(p),b._free(y),b._free(g),b._free(f)}}),e,t,a,r,s)}e.apply=t}(G||(G={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(U||(U={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Z||(Z={}));var B=a(22726),j=a(79429),F=a(86743),H=a(93277);let z=class extends((0,C.dM)((0,L.j)(c.A))){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE"},this._graphTypeLookup=new Map,this.dataManager=null,this.knowledgeGraph=null,this.layers=new r.A,this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map,this.linkChartExtent=new j.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new r.A,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new s.A("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){if(!this.title&&this.url){const e=this.url.split("/");this.title=e[e.length-2]}const t=new Set;let a=[],i=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new s.A("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");e.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this._graphTypeLookup.set(e.name,e)})),e.inclusionModeDefinition?.generateAllSublayers?(a=e.knowledgeGraph.dataModel.entityTypes??[],i=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((n,r)=>{const s=this._graphTypeLookup.get(r);if(!s)return o.A.getLogger(this).warn(`A named type, ${r}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(r);"relationship"===s.type?t.has(r)||(t.add(r),i.push(s)):"entity"===s.type?t.has(r)||(t.add(r),a.push(s)):(o.A.getLogger(this).warn(`A named type, ${r}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(r))})):(a=e.knowledgeGraph.dataModel.entityTypes??[],i=e.knowledgeGraph.dataModel.relationshipTypes??[]);const n=new g.PB({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=a,this.memberRelationshipTypes=i,this.dataManager=n}load(e){return this.addResolvingPromise(new Promise((t=>{(0,B.fetchKnowledgeGraph)(this.url).then((a=>{if(this._initializeLayerProperties({knowledgeGraph:a,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(e.name,{useAllData:!0})})),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(e.name,{useAllData:!0})}))),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((e=>{e.useAllData=!1,e.members?.forEach((e=>{let t;t=e.linkChartLocation instanceof y.A?e.linkChartLocation:e.linkChartLocation?(0,p.Ux)(e.linkChartLocation):null,t&&2===t.coords.length&&0===t.lengths.length?this.entityLinkChartDiagramLookup.set(e.id,t):this.relationshipLinkChartDiagramLookup.set(e.id,t)})),this.addResolvingPromise(this._initializeDiagram().then((async()=>{this.layers.forEach((async e=>{await e.refreshCachedQueryEngine()})),this.tables.forEach((async e=>{await e.refreshCachedQueryEngine()}))})))}));else{const t="GEOGRAPHIC"===this.defaultLinkChartConfig?.layoutMode;this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,t,!0).then((async()=>{(0,h.Te)(e);const t=[],a=[];this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1,this.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((e=>{e.useAllData=!1}))),await this._initializeDiagram(),this.layers.forEach((e=>{a.push(e.refreshCachedQueryEngine()),t.push(new Promise((t=>{e.on("layerview-create",(()=>{t(null)}))})))})),this.tables.forEach((e=>{a.push(e.refreshCachedQueryEngine())})),await Promise.all(a)})))}t(null)}))}))),Promise.resolve(this)}async addRecords(e,t){let a=[];t?.cascadeAddRelationshipEndNodes&&this.dataManager.knowledgeGraph.dataModel&&(a=await(0,m.aq)(e,this.dataManager.knowledgeGraph));const i=e.concat(a).filter((e=>!this.sublayerIdsCache.get(e.typeName)?.has(e.id)));await this._handleNewRecords(i)}async removeRecords(e,{cascadeRemoveRelationships:t=!0,recalculateLayout:a=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){let i=[];for(const r of e)!1===this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(r.typeName)?.useAllData&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(r.typeName)?.members?.has(r.id)&&i.push(r);if(t){const e=new Set,t=[];for(const a of i)if(this.dataManager.nodeConnectionsLookup.has(a.id))for(const t of this.dataManager.nodeConnectionsLookup.get(a.id))e.add(t);for(const a of e)if(this.dataManager.memberIdTypeLookup.has(a))for(const e of this.dataManager.memberIdTypeLookup.get(a))this.dataManager.relationshipTypeNames.has(e)&&t.push({id:a,typeName:e});i=i.concat(t)}this.dataManager.removeFromLayer(i);for(const r of i)this.sublayerIdsCache.get(r.typeName)?.delete(r.id),this.dataManager.relationshipTypeNames.has(r.typeName)?this.relationshipLinkChartDiagramLookup.delete(r.id):this.entityLinkChartDiagramLookup.delete(r.id);a&&await this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,this._currentLinkChartConfig.layoutOptions);const n=[];return this.layers.forEach((e=>{n.push(e.refreshCachedQueryEngine())})),await Promise.all(n),this._refreshNamedTypes(),i}async expand(e,t){const a=await this.dataManager.getConnectedRecordIds(e,t),i=a.filter((e=>!this.sublayerIdsCache.get(e.typeName)?.has(e.id)));return await this._handleNewRecords(a),{records:i}}loadLayerAssumingLocalCache(){this.memberRelationshipTypes.forEach((e=>{const t=new f.A({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((e=>{const t=new f.A({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)})),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{const a=(0,l.tE)(this.sublayerIdsCache,t,(()=>new Set));e.members?.forEach((e=>{if(a.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof y.A)this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(e.id,e.linkChartLocation):this.entityLinkChartDiagramLookup.set(e.id,e.linkChartLocation);else{const a=(0,p.Ux)(e.linkChartLocation);this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(e.id,e.linkChartLocation?a:null):this.entityLinkChartDiagramLookup.set(e.id,e.linkChartLocation?a:null)}}))}))}async calculateLinkChartLayout(e="RADIAL_TREE",t){const a=[],i=[],n=[];this.dataManager.sublayerCaches.forEach(((e,t)=>{this.dataManager.entityTypeNames.has(t)?e.forEach((e=>{a.push({typeName:t,feature:e})})):this.dataManager.relationshipTypeNames.has(t)&&e.forEach((e=>{i.push({typeName:t,feature:e})}))})),this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map;const r=new Map,l=new Map,h=new Map,u=new Map,d=new Uint8Array(a.length),c=new Float64Array(a.length),y=new Float64Array(a.length),f=new Uint32Array(i.length),m=new Uint32Array(i.length),C=[],L="FORCE_DIRECTED",w=new j.A({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let M,b="FORCE_DIRECTED",E=0,_=0;switch(b="GEOGRAPHIC"===e?L:e,b){case"FORCE_DIRECTED":M=x.apply;break;case"COMMUNITY":M=R.apply;break;case"HIERARCHICAL":M=S.apply;break;case"RADIAL_TREE":M=O.apply;break;case"SMART_TREE":M=P.apply;break;default:M=I.apply}a.forEach((({typeName:a,feature:i})=>{if(t?.lockedNodeLocations?.has(i.attributes[g.yC])){"GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(a)?d[E]=v.IsGeographic:d[E]=v.None;const n=t.lockedNodeLocations.get(i.attributes[g.yC]);c[E]=n.x,y[E]=n.y}else if("GEOGRAPHIC"===e&&this.dataManager.geographicLookup.has(a)){d[E]=v.IsGeographic;let e=null;const t=i.attributes[this.dataManager.geographicLookup.get(a).name],n=this.dataManager.geographicLookup.get(a)?.geometryType;switch(n){case"esriGeometryPoint":c[E]=t?.x,y[E]=t?.y;break;case"esriGeometryPolygon":e=t?.centroid,null!=e?.x&&null!=e?.y?(c[E]=e.x,y[E]=e.y):d[E]=v.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":e=t?.extent?.center,null!=e?.x&&null!=e?.y?(c[E]=e.x,y[E]=e.y):d[E]=v.IsMovable;break;default:d[E]=v.IsMovable}(null==c[E]||null==y[E]||Number.isNaN(c[E])||Number.isNaN(y[E]))&&(d[E]=v.IsMovable,c[E]=0,y[E]=0)}else d[E]=v.IsMovable,c[E]=0,y[E]=0;u.set(i.attributes[g.yC],E),C[E]={feature:i,typeName:a},E++}));let A=!1;const D=new Map;i.forEach((e=>{const t=e.feature.attributes[g.Vr],a=e.feature.attributes[g.ZL],i=u.get(t),r=u.get(a);if(void 0!==i&&void 0!==r){const s=t+"-"+a,o=D.get(s),l=o?.has(e.typeName);l||(f[_]=i,m[_]=r,void 0===o?D.set(s,new Map([[e.typeName,_]])):o.set(e.typeName,_),_++),n.push(e)}else A=!0,this.relationshipLinkChartDiagramLookup.set(t,null)})),A&&o.A.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null");const N=this._validateLayoutSettings(e,t),G=this._convertLayoutSettingsToCalculationSettings(N);await k();const{success:U,links:Z}=M(d,c,y,f.subarray(0,_),m.subarray(0,_),G.computationBudgetTime,G.idealEdgeLengthMultiplier,G.repulsionRadiusMultiplier);if(!U)throw new s.A("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let s=0;s<C.length;s++){if(y[s]>84.9999?y[s]=84.9999:y[s]<-84.9999&&(y[s]=-84.9999),c[s]>179.9999?c[s]=179.9999:c[s]<-179.9999&&(c[s]=-179.9999),C[s].feature.attributes[g.sZ]=new F.A(c[s],y[s]),r.has(C[s].typeName)){const e=r.get(C[s].typeName);e?.set(C[s].feature.attributes[g.yC],C[s].feature)}else{const e=new Map;e.set(C[s].feature.attributes[g.yC],C[s].feature),r.set(C[s].typeName,e)}h.set(C[s].feature.attributes[g.yC],C[s].feature);const e=(0,p.Ux)(C[s].feature.attributes[g.sZ]);this.entityLinkChartDiagramLookup.set(C[s].feature.attributes[g.yC],C[s].feature.attributes[g.sZ]?e:null),C[s].feature.attributes[g.sZ].x<w.xmin&&(w.xmin=C[s].feature.attributes[g.sZ].x),C[s].feature.attributes[g.sZ].x>w.xmax&&(w.xmax=C[s].feature.attributes[g.sZ].x),C[s].feature.attributes[g.sZ].y<w.ymin&&(w.ymin=C[s].feature.attributes[g.sZ].y),C[s].feature.attributes[g.sZ].y>w.ymax&&(w.ymax=C[s].feature.attributes[g.sZ].y)}if(this.linkChartExtent.xmin=w.xmin,this.linkChartExtent.xmax=w.xmax,this.linkChartExtent.ymin=w.ymin,this.linkChartExtent.ymax=w.ymax,!Z)throw new s.A("knowledge-graph:layout-failed","Attempting to retrieve link geometry from diagram engine failed");const B=new Map,z=new Map,Y=new Map,J=new Set;for(let s=0;s<n.length;s++){const e=[],t=n[s],a=t.feature.attributes[g.Vr],i=t.feature.attributes[g.ZL],r=a+"-"+i,d=D.get(r).get(t.typeName),c=0===d?0:Z?.vertexEndIndex[d-1];if(!J.has(d)){if(J.add(d),Z.types[d]===T.Recursive){const t=[Z.vertices[2*c],Z.vertices[2*c+1]],a=[Z.vertices[2*(c+1)],Z.vertices[2*(c+1)+1]],i=[.5*(t[0]+a[0]),.5*(t[1]+a[1])],n=[i[0]-t[0],i[1]-t[1]],r=[i[0]+n[1],i[1]-n[0]],s=[i[0]-n[1],i[1]+n[0]];e.push(t),e.push(r),e.push(a),e.push(s),e.push(t)}else{if(Z.types[d]!==T.Regular){o.A.getLogger(this).warn("A relationship generated an unsupported link geometry type.  It will not be rendered");continue}for(let t=c;t<Z.vertexEndIndex[d];t++)e.push([Z.vertices[2*t],Z.vertices[2*t+1]])}const t=C[u.get(a)]?.feature.attributes[g.sZ],n=C[u.get(i)]?.feature.attributes[g.sZ];e[0][0]===t.x&&e[0][1]===t.y||(e[0]=[t.x,t.y]),e[e.length-1][0]===n.x&&e[e.length-1][1]===n.y||(e[e.length-1]=[n.x,n.y]);for(let a=1;a<e.length-1;a++)e[a][1]>85.5?e[a][1]=85.5:e[a][1]<-85.5&&(e[a][1]=-85.5),e[a][0]>179.9999?e[a][0]=179.9999:e[a][0]<-179.9999&&(e[a][0]=-179.9999);B.has(r)?B.get(r).push(e):B.set(r,[e])}const y=B.get(r);z.has(r)||(z.set(r,new Map),Y.set(r,new Map));const f=z.get(r),m=Y.get(r);f.has(t.typeName)||(f.set(t.typeName,y.shift()),m.set(t.typeName,0));const L=f.get(t.typeName);m.set(t.typeName,m.get(t.typeName)+1);const w=new H.A({paths:L});if(t.feature.attributes[g.sZ]=w,l.has(t.typeName)){const e=l.get(t.typeName);e?.set(t.feature.attributes[g.yC],t.feature)}else{const e=new Map;e.set(t.feature.attributes[g.yC],t.feature),l.set(t.typeName,e)}h.set(t.feature.attributes[g.yC],t.feature);const M=(0,p.Ux)(t.feature.attributes[g.sZ]);this.relationshipLinkChartDiagramLookup.set(t.feature.attributes[g.yC],t.feature.attributes[g.sZ]?M:null)}for(const s of n)s.feature.attributes[g.d4]=Y.get(s.feature.attributes[g.Vr]+"-"+s.feature.attributes[g.ZL])?.get(s.typeName)??null;return this._currentLinkChartConfig={layoutMode:e,layoutOptions:N},{nodes:r,links:l,idMap:h}}async applyNewLinkChartLayout(e="RADIAL_TREE",t){const a=[];await this.calculateLinkChartLayout(e,t),this.layers.forEach((e=>{a.push(e.refreshCachedQueryEngine())})),await Promise.all(a),this._refreshNamedTypes()}getCurrentNodeLocations(){const e=new Map;return this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((t=>{t?.members?.forEach((t=>{const a=t.linkChartLocation;let i;const n=t.id;a&&(i="x"in a?{x:a.x,y:a.y}:{x:a.coords[0],y:a.coords[1]},e.set(n,new F.A({x:i.x,y:i.y})))}))})),e}async synchronizeInclusionListWithCache(){return new Promise((e=>{this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{if(e.useAllData=!1,e.members&&e.members.size>0){if(!this.dataManager.sublayerCaches.get(t))return;const a=new Set(Array.from(this.dataManager.sublayerCaches.get(t).keys()));Array.from(e.members.keys()).filter((e=>!a.has(e))).forEach((t=>{e.members?.delete(t)}))}})),e()}))}async refreshLinkChartCache(e){await this.dataManager.refreshCacheContent(e);const t=[];this.layers.forEach((e=>{t.push(e.refreshCachedQueryEngine())})),await Promise.all(t),this._refreshNamedTypes()}async connectEntities(e){let t=[];for(const i of this.dataManager.relationshipTypeNames){const e=this.sublayerIdsCache.get(i);e&&(t=t.concat(Array.from(e.keys())))}const a=await this.dataManager.getAttachedRelationships(e,t);return await this._handleNewRecords(a),{records:a}}async _handleNewRecords(e){const t=[];this.dataManager.addToLayer(e);for(const i of e)this.sublayerIdsCache.has(i.typeName)||(this.sublayerIdsCache.set(i.typeName,new Set),t.push(i.typeName)),this.sublayerIdsCache.get(i.typeName).add(i.id);for(const i of t){const e=this._graphTypeLookup.get(i);if(e){const t=new f.A({objectType:e,parentCompositeLayer:this,graphType:e.type,title:i});"entity"===e.type?this.dataManager.entityTypeNames.add(i):this.dataManager.relationshipTypeNames.add(i),t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.set(i,new Map)}}await this.dataManager.refreshCacheContent(e.map((e=>e.id)));const a=Object.assign({},this._currentLinkChartConfig.layoutOptions);a.lockedNodeLocations=this.getCurrentNodeLocations(),await this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,a)}async _initializeDiagram(){this.defaultLinkChartConfig?this.defaultLinkChartConfig.doNotRecalculateLayout?(this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e?.members?.forEach((e=>{const a=e.linkChartLocation;let i;const n=e.id;if(!a)return;i="x"in a?{x:a.x,y:a.y}:{x:a.coords[0],y:a.coords[1]};const r=(0,p.Ux)(i);this.dataManager.relationshipTypeNames.has(t)?this.relationshipLinkChartDiagramLookup.set(n,r):this.entityLinkChartDiagramLookup.set(n,r),this.linkChartExtent.xmin>i.x&&(this.linkChartExtent.xmin=i.x),this.linkChartExtent.xmax<i.x&&(this.linkChartExtent.xmax=i.x),this.linkChartExtent.ymin>i.y&&(this.linkChartExtent.ymin=i.y),this.linkChartExtent.ymax<i.y&&(this.linkChartExtent.ymax=i.y)}))})),this.memberRelationshipTypes.forEach((e=>{e.name&&this.dataManager.sublayerCaches.get(e.name)?.forEach((e=>{const t=this.relationshipLinkChartDiagramLookup.get(e.attributes[g.Vr]),a=this.relationshipLinkChartDiagramLookup.get(e.attributes[g.ZL]);if(t&&a){const i=(0,p.Ux)(new H.A({paths:[[t.coords[0],t.coords[1]],[a.coords[0],a.coords[1]]]}));this.relationshipLinkChartDiagramLookup.set(e.attributes[g.yC],i)}else this.relationshipLinkChartDiagramLookup.set(e.attributes[g.yC],null)}))}))):await this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{lockedNodeLocations:this.getCurrentNodeLocations(),...this.defaultLinkChartConfig.layoutOptions||{}}):await this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()})}_refreshNamedTypes(){for(const e of this.layers)e.emit("refresh",{dataChanged:!0});for(const e of this.tables)e.emit("refresh",{dataChanged:!0})}_validateLayoutSettings(e,t){const a=e=>"number"==typeof e&&!isNaN(e),n=e=>a(e)&&e>=1,r=e=>a(e)&&e>=1,s=e=>Object.values(i).includes(e),l=e=>a(e)&&e>=0,h=new Set(["FORCE_DIRECTED","COMMUNITY","GEOGRAPHIC"]),u={};if(!h.has(e)||!t)return!h.has(e)&&t&&o.A.getLogger(this).warn("Layout mode options were given for a layout mode that does not utilize them, settings will be ignored"),u;const{computationBudgetTime:d,repulsionRadiusMultiplier:c,idealEdgeLength:p,idealEdgeLengthType:y}=t;r(d)?u.computationBudgetTime=d:void 0!==d&&o.A.getLogger(this).warn("Invalid layout computationBudgetTime setting, will revert to default setting"),n(c)?u.repulsionRadiusMultiplier=c:void 0!==c&&o.A.getLogger(this).warn("Invalid layout repulsionRadiusMultiplier setting, will revert to default setting");const g=void 0!==p||void 0!==y;return"GEOGRAPHIC"!==e&&g?o.A.getLogger(this).warn("Ideal edge length settings were specified for an incompatible layout mode, and will be ignored"):"GEOGRAPHIC"===e&&g&&(s(y)?u.idealEdgeLengthType=y:void 0!==y&&o.A.getLogger(this).warn('Invalid layout idealEdgeLengthType setting, will revert to "multiplier" setting'),l(p)?u.idealEdgeLength=p:void 0!==p&&o.A.getLogger(this).warn("Invalid layout idealEdgeLength setting, will revert to default setting")),u}_convertLayoutSettingsToCalculationSettings(e){let t=e.idealEdgeLength;return e.idealEdgeLengthType===i.ABSOLUTE&&(void 0===t?t=-1:t*=-1),{computationBudgetTime:e.computationBudgetTime,repulsionRadiusMultiplier:e.repulsionRadiusMultiplier,idealEdgeLengthMultiplier:t}}};(0,n._)([(0,u.MZ)()],z.prototype,"dataPreloadedInLocalCache",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"defaultLinkChartConfig",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"dataManager",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"knowledgeGraph",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"layers",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"entityLinkChartDiagramLookup",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"relationshipLinkChartDiagramLookup",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"linkChartExtent",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"memberEntityTypes",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"memberRelationshipTypes",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"sublayerIdsCache",void 0),(0,n._)([(0,u.MZ)()],z.prototype,"tables",void 0),(0,n._)([(0,u.MZ)({json:{read:!1}})],z.prototype,"type",void 0),z=(0,n._)([(0,d.$)("esri.layers.LinkChartLayer")],z);const Y=z},79019:function(e,t,a){a.d(t,{C1:function(){return k},Fm:function(){return L},Ih:function(){return C},M6:function(){return u},OZ:function(){return c},PY:function(){return h},Qo:function(){return g},Yj:function(){return y},fV:function(){return p},hG:function(){return b},hn:function(){return M},id:function(){return w},kF:function(){return d},ke:function(){return m}});var i=a(54971),n=a(79429),r=a(70616),s=a(27621),o=a(22375),l=a(84095);const h={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:i.K}}},u={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,a){t[a]=!e}}}},d={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:i.K}}},c={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:s.w}}},p={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:i.K}}},y={value:null,type:o.A,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:i.K}}};function g(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const f={write:{enabled:!0,layerContainerTypes:i.K},read:!0},m={type:Number,json:{origins:{"web-document":f,"portal-item":{write:!0}}}},C={...m,json:{...m.json,origins:{"web-document":{...f,write:{enabled:!0,layerContainerTypes:i.K,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,a)=>a&&"service"!==a.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition?.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,l.D)(t.layerDefinition.drawingInfo.transparency):void 0:(0,l.D)(t.drawingInfo.transparency)}}},L={type:n.A,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const a=n.A.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(a.spatialReference=r.A.fromJSON(t.spatialReference)),a}}}},read:!1}},w={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},M={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:i.K}}},name:"layerDefinition.minScale",write:!0}},b={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:i.K}}},name:"layerDefinition.maxScale",write:!0}},k={json:{write:{ignoreOrigin:!0,layerContainerTypes:i.K},origins:{"web-map":{read:!1,write:!1}}}}}}]);
//# sourceMappingURL=4796.9b0ae298.js.map