"use strict";(self["webpackChunkvue_arcgis_0905"]=self["webpackChunkvue_arcgis_0905"]||[]).push([[7243],{49427:function(e,t,r){r.d(t,{Sk:function(){return o},Zx:function(){return s},_X:function(){return a}});var i=r(96140);function s(e,t,r){const i=t.flatten((({sublayers:e})=>e)).length;return i!==e.length||(!!e.some((e=>e.originIdOf("minScale")>r||e.originIdOf("maxScale")>r||e.originIdOf("renderer")>r||e.originIdOf("labelingInfo")>r||e.originIdOf("opacity")>r||e.originIdOf("labelsVisible")>r||e.originIdOf("source")>r))||!n(e,t))}function o(e,t,r){return!!e.some((e=>{const t=e.source,s=!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(null==t.gdbVersion||t.gdbVersion===r);return e.commitProperty("renderer"),e.commitProperty("labelingInfo"),e.commitProperty("opacity"),e.commitProperty("labelsVisible"),!s||e.originIdOf("renderer")>i.Gr.SERVICE||e.originIdOf("labelingInfo")>i.Gr.SERVICE||e.originIdOf("opacity")>i.Gr.SERVICE||e.originIdOf("labelsVisible")>i.Gr.SERVICE}))||!n(e,t)}function n(e,t){if(!e?.length||null==t)return!0;const r=t.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>r.length)return!1;let i=0;const s=r.length;for(const{id:o}of e){for(;i<s&&r[i]!==o;)i++;if(i>=s)return!1}return!0}function a(e){return!!e&&e.some((e=>null!=e.minScale||null!=e.layerDefinition?.minScale))}},28992:function(e,t,r){r.d(t,{$:function(){return m}});r(44114);var i=r(68347),s=r(94720),o=r(38308),n=r(38776),a=r(80139),l=r(18244),u=r(8660),c=r(21839);function p(e,t,r,i,s){if(null==e)return null;const o=e.referencesGeometry()&&s?d(t,i,s):t,n=e.repurposeFeature(o);try{return e.evaluate({...r,$feature:n},e.services)}catch(f){return u.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",f),null}}const h=new Map;function d(e,t,r){const{transform:i,hasZ:s,hasM:o}=r;h.has(t)||h.set(t,f(t));const n=h.get(t)(e.geometry,i,s,o);return{...e,geometry:n}}function f(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,i,s)=>(0,c.Tr)(r,t,e,i,s);case"esriGeometryPolygon":return(e,r,i,s)=>(0,c.$X)(r,t,e,i,s);case"esriGeometryPolyline":return(e,r,i,s)=>(0,c.P5)(r,t,e,i,s);case"esriGeometryMultipoint":return(e,r,i,s)=>(0,c.SW)(r,t,e,i,s);default:return u.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new l.A("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}const y=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:i,a:s}=e;return[t,r,i,255*s]};class m{static findApplicableOverrides(e,t,r){if(e&&t){if(e.primitiveName){let i=!1;for(const t of r)if(t.primitiveName===e.primitiveName){i=!0;break}if(!i)for(const s of t)s.primitiveName===e.primitiveName&&r.push(s)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const i of e.effects)m.findApplicableOverrides(i,t,r);if(e.symbolLayers)for(const i of e.symbolLayers)m.findApplicableOverrides(i,t,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const i of e.effects)m.findApplicableOverrides(i,t,r);if(e.markerPlacement&&m.findApplicableOverrides(e.markerPlacement,t,r),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const i of e.markerGraphics)m.findApplicableOverrides(i,t,r),m.findApplicableOverrides(i.symbol,t,r)}else"CIMCharacterMarker"===e.type?m.findApplicableOverrides(e.symbol,t,r):"CIMHatchFill"===e.type?m.findApplicableOverrides(e.lineSymbol,t,r):"CIMPictureMarker"===e.type&&m.findApplicableOverrides(e.animatedSymbolProperties,t,r)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,a.K3)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=(0,a.rB)(e),i=e.primitiveName,s=[];for(const o of t)o.primitiveName===i&&s.push((0,a.rB)(o));return{type:"cim-effect-param",effect:r,overrides:(0,a.pk)(s)}}static async resolveSymbolOverrides(e,t,r,i,s,n,l){if(!e?.symbol)return null;let{symbol:u,primitiveOverrides:c}=e;const p=!!c;if(!p&&!i)return u;u=(0,o.o8)(u),c=(0,o.o8)(c);let h=!0;if(t||(t={attributes:{}},h=!1),p){if(h||(c=c.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),l||(c=c.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),c.length>0){const e={spatialReference:r,fields:(0,a.O2)(t.attributes),geometryType:s};await m.createRenderExpressions(c,e),m.evaluateOverrides(c,t,s??"esriGeometryPoint",n,l)}m.applyOverrides(u,c)}return i&&m.applyDictionaryTextOverrides(u,t,i,null),u}static async createRenderExpressions(e,t){const r=[];for(const i of e){const e=i.valueExpressionInfo;if(!e||m._expressionToRenderExpression.has(e.expression))continue;const s=(0,n.Ad)(e.expression,t.spatialReference,t.fields);r.push(s),s.then((t=>m._expressionToRenderExpression.set(e.expression,t)))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,t,r,i,o){const n={$view:{scale:o?.scale}};for(const a of e){a.value&&"object"==typeof a.value&&(0,s.IB)(a.value)&&("Color"===a.propertyName||"StrokeColor"===a.propertyName)&&(a.value=y(a.value));const e=a.valueExpressionInfo;if(!e)continue;const o=m._expressionToRenderExpression.get(e.expression);o&&(a.value=p(o,t,n,r,i))}}static applyDictionaryTextOverrides(e,t,r,i,s="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const n of o)n&&"CIMVectorMarker"===n.type&&m.applyDictionaryTextOverrides(n,t,r,i,"CIMTextSymbol"===e.type?e.textCase:s)}break;case"CIMVectorMarker":{const s=e.markerGraphics;if(!s)return;for(const e of s)e&&m.applyDictionaryTextOverrides(e,t,r,i)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const n=(0,a.gQ)(o,r);e.textString=(0,a.FM)(t,n,i,s)}}}}static applyOverrides(e,t,r,i){if(e.primitiveName)for(const s of t)if(s.primitiveName===e.primitiveName){const t=(0,a.YF)(s.propertyName);if(i&&i.push({cim:e,nocapPropertyName:t,value:e[t]}),r){let t=!1;for(const i of r)i.primitiveName===e.primitiveName&&(t=!0);t||r.push(s)}null!=s.value&&(e[t]=s.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)m.applyOverrides(s,t,r,i);if(e.symbolLayers)for(const s of e.symbolLayers)m.applyOverrides(s,t,r,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const s of e.effects)m.applyOverrides(s,t,r,i);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const s of e.markerGraphics)m.applyOverrides(s,t,r,i),m.applyOverrides(s.symbol,t,r,i)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const r of e)void 0!==r.value&&(t+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new i.A(t).toRgba();return e[3]*=255,e}return t}}m._expressionToRenderExpression=new Map},46468:function(e,t,r){r.d(t,{LG:function(){return h},mb:function(){return y},yr:function(){return d}});var i=r(13570),s=r(4260),o=r(45355),n=r(1206),a=r(49602),l=r(22889),u=r(79721),c=r(87501),p=r(54361);function h(e){return e&&"render"in e}function d(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}function f(e){return h(e)?e instanceof l.A?e.getRenderedRasterPixels()?.renderedRasterPixels:d(e):e}class y extends a.q{constructor(e=null,t=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=t,this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){null==e&&null==this._source||(this._source=e,this.invalidateTexture(),this.requestRender())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e)}async setSourceAsync(e,t){null!=this._uploadStatus&&this._uploadStatus.controller.abort();const r=new AbortController,s=(0,i.Tw)();return(0,i.NY)(t,(()=>r.abort())),(0,i.NY)(r,(e=>s.reject(e))),this._uploadStatus={controller:r,resolver:s},this.source=e,s.promise}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(e,t){e>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(e,t)}setTransform(e){const t=(0,s.D_)(this.transforms.displayViewScreenMat3),[r,i]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.resolution/this.pixelRatio/e.resolution,a=o*this.width,l=o*this.height,u=Math.PI*this.rotation/180;(0,s.Tl)(t,t,(0,n.fA)(r,i)),(0,s.Tl)(t,t,(0,n.fA)(a/2,l/2)),(0,s.e$)(t,t,-u),(0,s.Tl)(t,t,(0,n.fA)(-a/2,-l/2)),(0,s.Oe)(t,t,(0,n.fA)(a,l)),(0,s.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,t)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind(e,t){this._texture&&e.bindTexture(this._texture,t)}async updateTexture({context:e,painter:t}){if(!this._textureInvalidated)return;if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(e)),!this.source)return void this._texture.setData(null);this._texture.resize(this._sourceWidth,this._sourceHeight);const r=f(this.source);try{if(null!=this._uploadStatus){const{controller:e,resolver:i}=this._uploadStatus,s={signal:e.signal},{width:o,height:n}=this,a=this._texture,l=t.textureUploadManager;await l.enqueueTextureUpdate({data:r,texture:a,width:o,height:n},s),i.resolve(),this._uploadStatus=null}else this._texture.setData(r);this.ready()}catch(s){(0,i.jH)(s)}}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:(0,o.vt)()}}_createTexture(e){const t=this.immutable,r=new p.R;return r.internalFormat=t?u.H0.RGBA8:u.Ab.RGBA,r.wrapMode=u.pF.CLAMP_TO_EDGE,r.isImmutable=t,r.width=this._sourceWidth,r.height=this._sourceHeight,new c.g(e,r)}}},22889:function(e,t,r){r.d(t,{A:function(){return i}});r(16573),r(78100),r(77936),r(37467),r(44732),r(79577);class i{constructor(e,t,r){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=r}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(e){const t=this.pixelBlock;if(null==t)return;const r=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??t});if(null==r.pixelBlock)return;r.pixelBlock.maskIsAlpha&&(r.pixelBlock.premultiplyAlpha=!0);const i=r.pixelBlock.getAsRGBA(),s=e.createImageData(r.pixelBlock.width,r.pixelBlock.height);s.data.set(i),e.putImageData(s,0,0)}getRenderedRasterPixels(){const e=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==e.pixelBlock?null:(e.pixelBlock.maskIsAlpha&&(e.pixelBlock.premultiplyAlpha=!0),{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)})}}},69166:function(e,t,r){r.d(t,{A:function(){return u}});var i=r(40399),s=(r(8660),r(9302),r(95753),r(18244),r(39834)),o=r(59815),n=r(227),a=r(20662);let l=class extends n.f{get hasHighlight(){return this.children.some((e=>e.hasData))}renderChildren(e){this.attributeView.update(),e.drawPhase===o.S5.HIGHLIGHT&&this.children.some((e=>e.hasData))&&(super.renderChildren(e),e.context.setColorMask(!0,!0,!0,!0),(0,a.lB)(e,!0,(e=>{this._renderChildren(e,o.RI.All)})))}};l=(0,i._)([(0,s.$)("esri.views.2d.layers.graphics.HighlightGraphicContainer")],l);const u=l},82458:function(e,t,r){r.d(t,{Uh:function(){return ee},ox:function(){return K}});r(17642),r(58004),r(33853),r(45876),r(32475),r(15024),r(31698);var i=r(40399),s=r(26052),o=r(13592),n=r(39930),a=r(81677),l=r(18244),u=r(29245),c=r(9302),p=r(71207),h=r(13570),d=r(78574),f=r(6002),y=r(98569),m=r(36861),g=(r(8660),r(39834)),b=r(79429),x=r(9914),v=r(12014),w=r(11754),_=r(22083),M=r(5049),I=r(55555),S=r(86970),A=r(55910),O=r(84427),P=r(49427);function k(e,t){const{dpi:r,gdbVersion:i,geometry:s,geometryPrecision:o,height:n,historicMoment:a,layerOption:l,mapExtent:u,maxAllowableOffset:c,returnFieldName:p,returnGeometry:h,returnUnformattedValues:d,returnZ:f,spatialReference:y,timeExtent:m,tolerance:g,width:b}=e.toJSON(),{dynamicLayers:x,layerDefs:v,layerIds:w}=T(e),_=null!=t?.geometry?t.geometry:null,M={historicMoment:a,geometryPrecision:o,maxAllowableOffset:c,returnFieldName:p,returnGeometry:h,returnUnformattedValues:d,returnZ:f,tolerance:g},I=_?.toJSON()||s;M.imageDisplay=`${b},${n},${r}`,i&&(M.gdbVersion=i),I&&(delete I.spatialReference,M.geometry=JSON.stringify(I),M.geometryType=(0,A.$B)(I));const S=y??I?.spatialReference??u?.spatialReference;if(S&&(M.sr=(0,O.YX)(S)),M.time=m?[m.start,m.end].join(","):null,u){const{xmin:e,ymin:t,xmax:r,ymax:i}=u;M.mapExtent=`${e},${t},${r},${i}`}return v&&(M.layerDefs=v),x&&!v&&(M.dynamicLayers=x),M.layers="popup"===l?"visible":l,w&&!x&&(M.layers+=`:${w.join(",")}`),M}function T(e){const{mapExtent:t,floors:r,width:i,sublayers:s,layerIds:o,layerOption:n,gdbVersion:a}=e,l=s?.find((e=>null!=e.layer))?.layer?.serviceSublayers,u="popup"===n,c={},p=(0,x.X_)({extent:t,width:i,spatialReference:t?.spatialReference}),h=[],d=e=>{const t=0===p,r=0===e.minScale||p<=e.minScale,i=0===e.maxScale||p>=e.maxScale;if(e.visible&&(t||r&&i))if(e.sublayers)e.sublayers.forEach(d);else{if(!1===o?.includes(e.id)||u&&(!e.popupTemplate||!e.popupEnabled))return;h.unshift(e)}};if(s?.forEach(d),s&&!h.length)c.layerIds=[];else{const e=(0,P.Sk)(h,l,a),t=h.map((e=>{const t=(0,w.f)(r,e);return e.toExportImageJSON(t)}));if(e)c.dynamicLayers=JSON.stringify(t);else{if(s){let e=h.map((({id:e})=>e));o&&(e=e.filter((e=>o.includes(e)))),c.layerIds=e}else o?.length&&(c.layerIds=o);const e=R(r,h);if(null!=e&&e.length){const t={};for(const r of e)r.definitionExpression&&(t[r.id]=r.definitionExpression);Object.keys(t).length&&(c.layerDefs=JSON.stringify(t))}}}return c}function R(e,t){const r=!!e?.length,i=t.filter((e=>null!=e.definitionExpression||r&&null!=e.floorInfo));return i.length?i.map((t=>{const r=(0,w.f)(e,t),i=(0,f.m)(r,t.definitionExpression);return{id:t.id,definitionExpression:i??void 0}})):null}var E,C=r(32334),F=r(17495),G=r(17010),N=r(1453),V=(r(95753),r(63955)),B=r(70616);let Z=E=class extends G.oY{static from(e){return(0,N.PZ)(E,e)}constructor(e){super(e),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.historicMoment=null,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}};(0,i._)([(0,m.MZ)({type:Number,json:{write:!0}})],Z.prototype,"dpi",void 0),(0,i._)([(0,m.MZ)()],Z.prototype,"floors",void 0),(0,i._)([(0,m.MZ)({type:String,json:{write:!0}})],Z.prototype,"gdbVersion",void 0),(0,i._)([(0,m.MZ)({types:C.yR,json:{read:A.rS,write:!0}})],Z.prototype,"geometry",void 0),(0,i._)([(0,m.MZ)({type:Number,json:{write:!0}})],Z.prototype,"geometryPrecision",void 0),(0,i._)([(0,m.MZ)({type:Number,json:{write:!0}})],Z.prototype,"height",void 0),(0,i._)([(0,m.MZ)({type:Date})],Z.prototype,"historicMoment",void 0),(0,i._)([(0,V.K)("historicMoment")],Z.prototype,"writeHistoricMoment",null),(0,i._)([(0,m.MZ)({type:[Number],json:{write:!0}})],Z.prototype,"layerIds",void 0),(0,i._)([(0,m.MZ)({type:["top","visible","all","popup"],json:{write:!0}})],Z.prototype,"layerOption",void 0),(0,i._)([(0,m.MZ)({type:b.A,json:{write:!0}})],Z.prototype,"mapExtent",void 0),(0,i._)([(0,m.MZ)({type:Number,json:{write:!0}})],Z.prototype,"maxAllowableOffset",void 0),(0,i._)([(0,m.MZ)({type:Boolean,json:{write:!0}})],Z.prototype,"returnFieldName",void 0),(0,i._)([(0,m.MZ)({type:Boolean,json:{write:!0}})],Z.prototype,"returnGeometry",void 0),(0,i._)([(0,m.MZ)({type:Boolean,json:{write:!0}})],Z.prototype,"returnM",void 0),(0,i._)([(0,m.MZ)({type:Boolean,json:{write:!0}})],Z.prototype,"returnUnformattedValues",void 0),(0,i._)([(0,m.MZ)({type:Boolean,json:{write:!0}})],Z.prototype,"returnZ",void 0),(0,i._)([(0,m.MZ)({type:B.A,json:{write:!0}})],Z.prototype,"spatialReference",void 0),(0,i._)([(0,m.MZ)()],Z.prototype,"sublayers",void 0),(0,i._)([(0,m.MZ)({type:F.A,json:{write:!0}})],Z.prototype,"timeExtent",void 0),(0,i._)([(0,m.MZ)({type:Number,json:{write:!0}})],Z.prototype,"tolerance",void 0),(0,i._)([(0,m.MZ)({type:Number,json:{write:!0}})],Z.prototype,"width",void 0),Z=E=(0,i._)([(0,g.$)("esri.rest.support.IdentifyParameters")],Z);const j=Z;var L=r(29811),H=r(83616);let D=class extends G.oY{constructor(e){super(e),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(e,t){return s.A.fromJSON({attributes:{...t.attributes},geometry:{...t.geometry}})}writeFeature(e,t){if(!e)return;const{attributes:r,geometry:i}=e;r&&(t.attributes={...r}),null!=i&&(t.geometry=i.toJSON(),t.geometryType=H.Y.toJSON(i.type))}};(0,i._)([(0,m.MZ)({type:String,json:{write:!0}})],D.prototype,"displayFieldName",void 0),(0,i._)([(0,m.MZ)({type:s.A})],D.prototype,"feature",void 0),(0,i._)([(0,L.w)("feature",["attributes","geometry"])],D.prototype,"readFeature",null),(0,i._)([(0,V.K)("feature")],D.prototype,"writeFeature",null),(0,i._)([(0,m.MZ)({type:Number,json:{write:!0}})],D.prototype,"layerId",void 0),(0,i._)([(0,m.MZ)({type:String,json:{write:!0}})],D.prototype,"layerName",void 0),D=(0,i._)([(0,g.$)("esri.rest.support.IdentifyResult")],D);const $=D;async function U(e,t,r){const i=(t=Q(t)).geometry?[t.geometry]:[],s=(0,S.Dl)(e);return s.path+="/identify",(0,I.el)(i).then((e=>{const i=k(t,{geometry:e?.[0]}),o=(0,S.lF)({...s.query,f:"json",...i}),n=(0,S.jV)(o,r);return(0,M.A)(s.path,n).then(q).then((e=>J(e,t.sublayers)))}))}function q(e){const t=e.data;return t.results=t.results||[],t.exceededTransferLimit=Boolean(t.exceededTransferLimit),t.results=t.results.map((e=>$.fromJSON(e))),t}function Q(e){return j.from(e)}function J(e,t){if(!t?.length)return e;const r=new Map;function i(e){r.set(e.id,e),e.sublayers&&e.sublayers.forEach(i)}t.forEach(i);for(const s of e.results)s.feature.sourceLayer=r.get(s.layerId);return e}var W=r(38776),z=r(86820),Y=r(67929);let X=null;function K(e,t){return"tile"===t.type||"map-image"===t.type}let ee=class extends o.A{constructor(e){super(e),this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,h.sg)((async e=>{this.destroyed||this.updatingHandles.addPromise(this._updateHighlightedFeaturesGeometries(e).catch((()=>{})))}))}initialize(){const e=e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e).catch((()=>{}))),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,d.on)((()=>this.highlightGraphics),"change",(t=>e(t.added)),{onListenerAdd:t=>e(t)})])}async fetchPopupFeaturesAtLocation(e,t){const{layerView:{layer:r,view:{scale:i}}}=this;if(!e)throw new l.A("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:r});const s=te(r.sublayers,i,t);if(!s.length)return[];const o=await ie(r,s);if(!((r.capabilities?.operations?.supportsIdentify??1)&&r.version>=10.5)&&!o)throw new l.A("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:r});return o?this._fetchPopupFeaturesUsingQueries(e,s,t):this._fetchPopupFeaturesUsingIdentify(e,s,t)}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(e){const t=this.highlightGraphics;if(!t)return(0,u.hA)();let r=null;if(e instanceof s.A?r=[e]:a.A.isCollection(e)&&e.length>0?r=e.toArray():Array.isArray(e)&&e.length>0&&(r=e),r=r?.filter(n.Ru),!r?.length)return(0,u.hA)();for(const i of r){const e=i.sourceLayer;null!=e&&"geometryType"in e&&"point"===e.geometryType&&(i.visible=!1)}return t.addMany(r),(0,u.hA)((()=>t.removeMany(r??[])))}async _updateHighlightedFeaturesSymbols(e){const{layerView:{view:t},highlightGraphics:i,highlightGraphicUpdated:s}=this;if(i&&s)for(const o of e){const e=o.sourceLayer&&"renderer"in o.sourceLayer&&o.sourceLayer.renderer;o.sourceLayer&&"geometryType"in o.sourceLayer&&"point"===o.sourceLayer.geometryType&&e&&"getSymbolAsync"in e&&e.getSymbolAsync(o).then((async n=>{n||=new z.A;let a=null;const l="visualVariables"in e?e.visualVariables?.find((e=>"size"===e.type)):void 0;l&&(X||(X=(await Promise.resolve().then(r.bind(r,74076))).getSize),a=X(l,o,{view:t.type,scale:t.scale,shape:"simple-marker"===n.type?n.style:null})),a||="width"in n&&"height"in n&&null!=n.width&&null!=n.height?Math.max(n.width,n.height):"size"in n?n.size:16,i.includes(o)&&(o.symbol=new z.A({style:"square",size:a,xoffset:"xoffset"in n?n.xoffset:0,yoffset:"yoffset"in n?n.yoffset:0}),s(o,"symbol"),o.visible=!0)}))}}async _updateHighlightedFeaturesGeometries(e){const{layerView:{layer:t,view:r},highlightGraphics:i,highlightGraphicUpdated:s}=this;if(this._highlightGeometriesResolution=e,!s||!i?.length||!t.capabilities.operations.supportsQuery)return;const o=this._getTargetResolution(e),n=new Map;for(const u of i)if(!this._featuresResolutions.has(u)||this._featuresResolutions.get(u)>o){const e=u.sourceLayer;(0,p.tE)(n,e,(()=>new Map)).set(u.getObjectId(),u)}const a=Array.from(n,(([e,t])=>{const i=e.createQuery();return i.objectIds=[...t.keys()],i.outFields=[e.objectIdField],i.returnGeometry=!0,i.maxAllowableOffset=o,i.outSpatialReference=r.spatialReference,e.queryFeatures(i)})),l=await Promise.all(a);if(!this.destroyed)for(const{features:u}of l)for(const e of u){const t=e.sourceLayer,r=n.get(t).get(e.getObjectId());r&&i.includes(r)&&(r.geometry=e.geometry,s(r,"geometry"),this._featuresResolutions.set(r,o))}}_getTargetResolution(e){const t=e*(0,y.GA)(this.layerView.view.spatialReference),r=t/16;return r<=10?0:e/t*r}async _fetchPopupFeaturesUsingIdentify(e,t,r){const i=await this._createIdentifyParameters(e,t,r);if(null==i)return[];const{results:s}=await U(this.layerView.layer.parsedUrl,i,r);return s.map((e=>e.feature))}async _createIdentifyParameters(e,t,r){const{floors:i,layer:s,timeExtent:o,view:{spatialReference:n,scale:a}}=this.layerView;if(!t.length)return null;await Promise.all(t.map((({sublayer:e})=>e.load(r).catch((()=>{})))));const l=Math.min((0,c.A)("mapservice-popup-identify-max-tolerance"),s.allSublayers.reduce(((e,t)=>t.renderer?(0,_.o)({renderer:t.renderer,pointerType:r?.pointerType}):e),2)),u=this.createFetchPopupFeaturesQueryGeometry(e,l),p=(0,x.i1)(a,n),h=Math.round(u.width/p),d=new b.A({xmin:u.center.x-p*h,ymin:u.center.y-p*h,xmax:u.center.x+p*h,ymax:u.center.y+p*h,spatialReference:u.spatialReference});return new j({floors:i,gdbVersion:"gdbVersion"in s?s.gdbVersion:void 0,geometry:e,height:h,layerOption:"popup",mapExtent:d,returnGeometry:!0,spatialReference:n,sublayers:s.sublayers,timeExtent:o,tolerance:l,width:h})}async _fetchPopupFeaturesUsingQueries(e,t,r){const{layerView:{floors:i,timeExtent:s}}=this,o=t.map((async({sublayer:t,popupTemplate:o})=>{if(await t.load(r).catch((()=>{})),t.capabilities&&!t.capabilities.operations.supportsQuery)return[];const n=t.createQuery(),a=(0,_.o)({renderer:t.renderer,pointerType:r?.pointerType}),l=this.createFetchPopupFeaturesQueryGeometry(e,a),u=new Set,[c]=await Promise.all([(0,Y.TO)(t,o),t.renderer?.collectRequiredFields(u,t.fieldsIndex)]);(0,h.Te)(r),(0,v._w)(u,t.fieldsIndex,c);const p=Array.from(u).sort();n.geometry=l,n.outFields=p,n.timeExtent=s;const d=(0,w.f)(i,t);n.where=(0,f.m)(n.where,d);const y=this._getTargetResolution(l.width/a),m=await re(o);(0,h.Te)(r);const g="point"===t.geometryType||m&&m.arcadeUtils.hasGeometryOperations(o);g||(n.maxAllowableOffset=y);let{features:b}=await t.queryFeatures(n,r);const x=g?0:y;b=await se(t,b,r);for(const e of b)this._featuresResolutions.set(e,x);return b}));return(await Promise.allSettled(o)).reduce(((e,t)=>"fulfilled"===t.status?[...e,...t.value]:e),[]).filter(n.Ru)}};function te(e,t,r){const i=[];if(!e)return i;const s=e=>{const o=0===e.minScale||t<=e.minScale,n=0===e.maxScale||t>=e.maxScale;if(e.visible&&o&&n)if(e.sublayers)e.sublayers.forEach(s);else if(e.popupEnabled){const t=(0,Y.D8)(e,{...r,defaultPopupTemplateEnabled:!1});null!=t&&i.unshift({sublayer:e,popupTemplate:t})}};return e.map(s),i}function re(e){return e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type))?(0,W.lw)():Promise.resolve()}async function ie(e,t){if(e.capabilities?.operations?.supportsQuery)return!0;try{return await Promise.any(t.map((({sublayer:e})=>e.load().then((()=>e.capabilities.operations.supportsQuery)))))}catch{return!1}}async function se(e,t,r){const i=e.renderer;return i&&"defaultSymbol"in i&&!i.defaultSymbol&&(t=i.valueExpression?await Promise.all(t.map((e=>i.getSymbolAsync(e,r).then((t=>t?e:null))))).then((e=>e.filter((e=>null!=e)))):t.filter((e=>null!=i.getSymbol(e)))),t}(0,i._)([(0,m.MZ)({constructOnly:!0})],ee.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],ee.prototype,"layerView",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],ee.prototype,"highlightGraphics",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],ee.prototype,"highlightGraphicUpdated",void 0),(0,i._)([(0,m.MZ)({constructOnly:!0})],ee.prototype,"updatingHandles",void 0),ee=(0,i._)([(0,g.$)("esri.views.layers.support.MapServiceLayerViewHelper")],ee)},67929:function(e,t,r){r.d(t,{D8:function(){return o},TO:function(){return s}});r(44114);var i=r(12014);async function s(e,t=e.popupTemplate){if(null==t)return[];const r=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:s}=t,{objectIdField:o,typeIdField:n,globalIdField:a,relationships:l}=e;if(r.includes("*"))return["*"];const u=s?(0,i.eX)(e):[],c=(0,i.DB)(e.fieldsIndex,[...r,...u]);return n&&c.push(n),c&&o&&e.fieldsIndex?.has(o)&&!c.includes(o)&&c.push(o),c&&a&&e.fieldsIndex?.has(a)&&!c.includes(a)&&c.push(a),l&&l.forEach((t=>{const{keyField:r}=t;c&&r&&e.fieldsIndex?.has(r)&&!c.includes(r)&&c.push(r)})),c}function o(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=7243.f5adfca0.js.map