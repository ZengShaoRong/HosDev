"use strict";(self["webpackChunkvue_arcgis_0905"]=self["webpackChunkvue_arcgis_0905"]||[]).push([[9047],{71897:function(t,e,i){i.d(e,{q:function(){return n}});var s=i(54401);class n{constructor(t,e){this._storage=new s.F,this.id="",this.name="",this.size=0,this._storage.maxSize=t,this._storage.register(this),e&&this._storage.registerRemoveFunc("",e)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(t,e,i=1){this._storage.put(this,t,e,i,1)}pop(t){return this._storage.pop(this,t)}get(t){return this._storage.get(this,t)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}resetHitRate(){}}},54401:function(t,e,i){i.d(e,{F:function(){return h},Mn:function(){return a}});i(44114);var s=i(73405);const n=-3,r=n-1;var o;!function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"}(o||(o={}));class a{constructor(t,e,i){this.name=t,this._storage=e,this.id=c+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(t){return this._storage.getSize(this,t)}resetHitRate(){this._hit=this._miss=0}put(t,e,i,s=0){this._storage.put(this,t,e,i,s)}pop(t){const e=this._storage.pop(this,t);return void 0===e?++this._miss:++this._hit,e}get(t){const e=this._storage.get(this,t);return void 0===e?++this._miss:++this._hit,e}peek(t){return this._storage.peek(this,t)}updateSize(t,e,i){this._storage.updateSize(this,t,e,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class h{get size(){return this._size}constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new s.A,this._users=new s.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,e){this._removeFuncs.push([t,e])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace((e=>e[0]!==t))}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,-1),this._checkSize()}getSize(t,e){const i=this._db.get(t.id+e);return i?.size??0}put(t,e,i,s,a){e=t.id+e;const h=this._db.get(e);if(h&&(this._size-=h.size,t.size-=h.size,this._db.delete(e),h.entry!==i&&this._notifyRemove(e,h.entry,h.size,o.ALL)),s>this._maxSize)return void this._notifyRemove(e,i,s,o.ALL);if(void 0===i)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${e}`),void this._notifyRemove(e,i,0,o.ALL);const c=1+Math.max(a,r)-n;this._db.set(e,new u(i,s,c)),this._size+=s,t.size+=s,this._checkSize()}updateSize(t,e,i,s){e=t.id+e;const n=this._db.get(e);if(n&&n.entry===i){for(this._size-=n.size,t.size-=n.size;s>this._maxSize;){const t=this._notifyRemove(e,i,s,o.SOME);if(!(null!=t&&t>0))return void this._db.delete(e);s=t}n.size=s,this._size+=s,t.size+=s,this._checkSize()}}pop(t,e){e=t.id+e;const i=this._db.get(e);if(i)return this._size-=i.size,t.size-=i.size,this._db.delete(e),++this._hit,i.entry;++this._miss}get(t,e){e=t.id+e;const i=this._db.get(e);if(void 0!==i)return this._db.delete(e),i.lives=i.lifetime,this._db.set(e,i),++this._hit,i.entry;++this._miss}peek(t,e){const i=this._db.get(t.id+e);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},e={},i=new Array;this._db.forEach(((t,s)=>{const n=t.lifetime;i[n]=(i[n]||0)+t.size,this._users.forAll((i=>{const{id:n,name:r}=i;if(s.startsWith(n)){const i=e[r]||0;e[r]=i+t.size}}))}));const s={};this._users.forAll((t=>{const i=t.name;if("hitRate"in t&&"number"==typeof t.hitRate&&!isNaN(t.hitRate)&&t.hitRate>0){const n=e[i]||0;e[i]=n,s[i]=Math.round(100*t.hitRate)+"%"}else s[i]="0%"}));const r=Object.keys(e);r.sort(((t,i)=>e[i]-e[t])),r.forEach((i=>t[i]=Math.round(e[i]/2**20)+"MB / "+s[i]));for(let o=i.length-1;o>=0;--o){const e=i[o];e&&(t["Priority "+(o+n-1)]=Math.round(e/this._size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll((t=>t.resetHitRate()))}clear(t){const e=t.id;this._db.forEach(((t,i)=>{i.startsWith(e)&&(this._size-=t.size,this._db.delete(i),this._notifyRemove(i,t.entry,t.size,o.ALL))})),t.size=0}clearAll(){this._db.forEach(((t,e)=>this._notifyRemove(e,t.entry,t.size,o.ALL))),this._users.forAll((t=>t.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,e,i,s){let n;return this._removeFuncs.some((r=>{if(t.startsWith(r[0])){const t=r[1](e,s,i);return"number"==typeof t&&(n=t),!0}return!1})),n}_checkSize(){this._users.forAll((t=>this._checkSizeLimits(t))),this._checkSizeLimits()}_checkSizeLimits(t){const e=t??this;if(e.maxSize<0||e.size<=e.maxSize)return;const i=t?.id;let s=!0;for(;s;){s=!1;for(const[n,r]of this._db)if(0===r.lifetime&&(!i||n.startsWith(i))){if(this._purgeItem(n,r,t),e.size<=.9*e.maxSize)return;s||=this._db.has(n)}}for(const[n,r]of this._db)if((!i||n.startsWith(i))&&(this._purgeItem(n,r,t),e.size<=.9*e.maxSize))return}_purgeItem(t,e,i=this._users.find((e=>t.startsWith(e.id)))){if(this._db.delete(t),e.lives<=1){this._size-=e.size,i&&(i.size-=e.size);const s=this._notifyRemove(t,e.entry,e.size,o.SOME);null!=s&&s>0&&(this._size+=s,i&&(i.size+=s),e.lives=e.lifetime,e.size=s,this._db.set(t,e))}else--e.lives,this._db.set(t,e)}}let c=0;class u{constructor(t,e,i){this.entry=t,this.size=e,this.lifetime=i,this.lives=i}}},32757:function(t,e,i){i.d(e,{C:function(){return o}});var s=i(13247),n=i(88015),r=i(71025);class o extends n.w{constructor(t){super({...t,constraint:new s.i7(t.targetPoint)})}get hints(){return[new r._(this.targetPoint,this.isDraped,this.domain)]}}},99047:function(t,e,i){i.r(e),i.d(e,{FeatureCollectionSnappingSource:function(){return f}});var s=i(40399),n=i(13592),r=i(45994),o=i(13570),a=i(78574),h=i(36861),c=(i(9302),i(8660),i(95753),i(39834)),u=i(68458),l=i(70594),d=i(46081),_=i(23521),g=i(60572),p=i(1379);let f=class extends n.A{get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:t}=this,{layer:e}=this.layerSource,i=null!=t&&"3d"===t.type;if(!i||"subtype-group"===e.type)return(0,_.n)();const s=async(i,s)=>(await(0,o.qr)(t.whenLayerView(e),s)).elevationAlignPointsInFeatures(i,s);return(0,_.n)(i,{elevationInfo:e.elevationInfo,alignPointsInFeatures:s})}get _snappingElevationFilter(){const{view:t}=this,e=null!=t&&"3d"===t.type&&"subtype-group"!==this.layerSource.layer.type;return(0,g.z)(e)}get _symbologySnappingFetcher(){const{view:t}=this,{layer:e}=this.layerSource;return null!=t&&"3d"===t.type&&"subtype-group"!==e.type?(0,p.H)(this._symbologySnappingSupported,(async(i,s)=>{const n=await t.whenLayerView(e);return(0,o.Te)(s),n.queryForSymbologySnapping({candidates:i,spatialReference:t.spatialReference},s)})):(0,p.H)()}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:t}=this,{layer:e}=this.layerSource;null!=t&&"3d"===t.type&&"subtype-group"!==e.type&&(t.whenLayerView(e).then((t=>this._layerView3D=t)),this.addHandles([t.elevationProvider.on("elevation-change",(({context:t})=>{const{elevationInfo:i}=e;(0,u.Up)(t,i)&&this._snappingElevationAligner.notifyElevationSourceChange()})),(0,a.wB)((()=>e.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),a.Vh),(0,a.wB)((()=>null!=this._layerView3D?this._layerView3D.layer?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),a.Vh),(0,a.on)((()=>this._layerView3D?.layer),["edits","apply-edits","graphic-update"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))]))}constructor(t){super(t),this.view=null,this._layerView3D=null,this._memoizedMakeGetGroundElevation=(0,r.B)(d.p)}refresh(){}async fetchCandidates(t,e){const{layer:i}=this.layerSource,s=i.source;if(!s?.querySnapping)return[];const n=(0,l.HN)(i),r=(0,l.nf)(t,this.view?.type??"2d",n),a=await s.querySnapping(r,{signal:e});(0,o.Te)(e);const h=t.coordinateHelper.spatialReference,c=await this._snappingElevationAligner.alignCandidates(a.candidates,h,e);(0,o.Te)(e);const u=await this._symbologySnappingFetcher.fetch(c,e);(0,o.Te)(e);const _=0===u.length?c:[...c,...u],g=this._snappingElevationFilter.filter(r,_),p=this._memoizedMakeGetGroundElevation(this.view,h);return g.map((t=>(0,d.$)(t,p)))}};(0,s._)([(0,h.MZ)({constructOnly:!0})],f.prototype,"layerSource",void 0),(0,s._)([(0,h.MZ)({constructOnly:!0})],f.prototype,"view",void 0),(0,s._)([(0,h.MZ)()],f.prototype,"_snappingElevationAligner",null),(0,s._)([(0,h.MZ)()],f.prototype,"_snappingElevationFilter",null),(0,s._)([(0,h.MZ)()],f.prototype,"_symbologySnappingFetcher",null),(0,s._)([(0,h.MZ)()],f.prototype,"_layerView3D",void 0),(0,s._)([(0,h.MZ)()],f.prototype,"_symbologySnappingSupported",null),f=(0,s._)([(0,c.$)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],f)},46081:function(t,e,i){i.d(e,{$:function(){return h},p:function(){return c}});var s=i(32238),n=i(11298),r=i(78492),o=i(32757);function a({x:t,y:e,z:i}){return(0,s.fA)(t,e,i??0)}function h(t,e){switch(t.type){case"edge":return t.draped?new n.X({edgeStart:a(t.start),edgeEnd:a(t.end),targetPoint:(0,s.de)(a(t.target)),objectId:t.objectId,getGroundElevation:e}):new r.z({edgeStart:a(t.start),edgeEnd:a(t.end),targetPoint:(0,s.de)(a(t.target)),objectId:t.objectId,isDraped:!1});case"vertex":return new o.C({targetPoint:(0,s.de)(a(t.target)),objectId:t.objectId,isDraped:!1})}}function c(t,e){return null!=t&&"3d"===t.type?(i,s)=>t.elevationProvider.getElevation(i,s,0,e,"ground"):()=>null}},23521:function(t,e,i){i.d(e,{n:function(){return h}});i(44114),i(9302);var s=i(71897),n=i(71207),r=i(13570),o=i(98569),a=i(11841);function h(t=!1,e){if(t){const{elevationInfo:t,alignPointsInFeatures:i}=e;return new l(t,i)}return new c}class c{async alignCandidates(t,e,i){return t}notifyElevationSourceChange(){}}const u=1024;class l{constructor(t,e){this._elevationInfo=t,this._alignPointsInFeatures=e,this._alignmentsCache=new s.q(u),this._cacheVersion=0}async alignCandidates(t,e,i){const s=this._elevationInfo;return null==s||"absolute-height"!==s.mode||s.featureExpressionInfo?this._alignComputedElevationCandidates(t,e,i):(g(t,e,s),t)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(t,e,i){const s=new Map;for(const r of t)(0,n.tE)(s,r.objectId,p).push(r);const[o,a,h]=this._prepareQuery(s,e),c=await this._alignPointsInFeatures(o,i);if((0,r.Te)(i),h!==this._cacheVersion)return this._alignComputedElevationCandidates(t,e,i);this._applyCacheAndResponse(o,c,a);const{drapedObjectIds:u,failedObjectIds:l}=c,d=[];for(const n of t){const{objectId:t}=n;u.has(t)&&"edge"===n.type&&(n.draped=!0),l.has(t)||d.push(n)}return d}_prepareQuery(t,e){const i=[],s=[];for(const[n,r]of t){const t=[];for(const e of r)this._addToQueriesOrCachedResult(n,e.target,t,s),"edge"===e.type&&(this._addToQueriesOrCachedResult(n,e.start,t,s),this._addToQueriesOrCachedResult(n,e.end,t,s));0!==t.length&&i.push({objectId:n,points:t})}return[{spatialReference:e.toJSON(),pointsInFeatures:i},s,this._cacheVersion]}_addToQueriesOrCachedResult(t,e,i,s){const n=_(t,e),r=this._alignmentsCache.get(n);null==r?i.push(e):s.push(new d(e,r))}_applyCacheAndResponse(t,{elevations:e,drapedObjectIds:i,failedObjectIds:s},n){for(const a of n)a.apply();let r=0;const o=this._alignmentsCache;for(const{objectId:a,points:h}of t.pointsInFeatures){if(s.has(a)){r+=h.length;continue}const t=!i.has(a);for(const i of h){const s=_(a,i),n=e[r++];i.z=n,t&&o.put(s,n,1)}}}}class d{constructor(t,e){this.point=t,this.z=e}apply(){this.point.z=this.z}}function _(t,{x:e,y:i,z:s,spatialReference:n}){return`${t}-${e}-${i}-${s??0}}-wkid:${n?.wkid}`}function g(t,e,i){const{offset:s,unit:n}=i;if(null==s)return;const r=(0,o.G9)(e),h=s*((0,a.Ao)(n??"meters")/r);for(const o of t)switch(o.type){case"edge":o.start.z+=h,o.end.z+=h;continue;case"vertex":o.target.z+=h;continue}}function p(){return[]}},60572:function(t,e,i){i.d(e,{z:function(){return o}});i(9302);class s{filter(t,e){return e}notifyElevationSourceChange(){}}class n{filter(t,e){const{point:i,distance:s}=t,{z:n}=i;if(null==n)return e;if(0===e.length)return e;const o=u(s),a=this._updateCandidatesTo3D(e,i,o).filter(r);return a.sort(l),a}_updateCandidatesTo3D(t,e,i){for(const s of t)switch(s.type){case"edge":a(s,e,i);continue;case"vertex":c(s,e,i);continue}return t}}function r(t){return t.distance<=1}function o(t=!1){return t?new n:new s}function a(t,e,{x:i,y:s,z:n}){const{start:r,end:o,target:a}=t;t.draped||h(a,e,r,o);const c=(e.x-a.x)/i,u=(e.y-a.y)/s,l=(e.z-a.z)/n;t.distance=Math.sqrt(c*c+u*u+l*l)}function h(t,e,i,s){const n=s.x-i.x,r=s.y-i.y,o=s.z-i.z,a=n*n+r*r+o*o,h=(e.x-i.x)*n+(e.y-i.y)*r+o*(e.z-i.z),c=Math.min(1,Math.max(0,h/a)),u=i.x+n*c,l=i.y+r*c,d=i.z+o*c;t.x=u,t.y=l,t.z=d}function c(t,e,{x:i,y:s,z:n}){const{target:r}=t,o=(e.x-r.x)/i,a=(e.y-r.y)/s,h=(e.z-r.z)/n,c=Math.sqrt(o*o+a*a+h*h);t.distance=c}function u(t){return"number"==typeof t?{x:t,y:t,z:t}:t}function l(t,e){return t.distance-e.distance}},1379:function(t,e,i){i.d(e,{H:function(){return a}});i(44114),i(9302);var s=i(38308),n=i(71897),r=i(13570),o=i(45557);function a(t=!1,e){return t?new u(e):new h}class h{async fetch(){return[]}notifySymbologyChange(){}}const c=1024;class u{constructor(t){this._getSymbologyCandidates=t,this._candidatesCache=new n.q(c),this._cacheVersion=0}async fetch(t,e){if(0===t.length)return[];const i=[],n=[],o=this._candidatesCache;for(const r of t){const t=l(r),e=o.get(t);if(e)for(const i of e)n.push((0,s.o8)(i));else i.push(r),o.put(t,[],1)}if(0===i.length)return n;const a=this._cacheVersion,{candidates:h,sourceCandidateIndices:c}=await this._getSymbologyCandidates(i,e);if((0,r.Te)(e),a!==this._cacheVersion)return this.fetch(t,e);const u=[],{length:d}=h;for(let r=0;r<d;++r){const t=h[r],e=l(i[c[r]]),n=o.get(e);n.push(t),o.put(e,n,n.length),u.push((0,s.o8)(t))}return n.concat(u)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function l(t){switch(t.type){case"vertex":{const{objectId:e,target:i}=t,s=`${e}-vertex-${i.x}-${i.y}-${i.z??0}`;return(0,o.Wm)(s).toString()}case"edge":{const{objectId:e,start:i,end:s}=t,n=`${e}-edge-${i.x}-${i.y}-${i.z??0}-to-${s.x}-${s.y}-${s.z??0}`;return(0,o.Wm)(n).toString()}default:return""}}}}]);
//# sourceMappingURL=9047.1dcec571.js.map