"use strict";(self["webpackChunkvue_arcgis_0905"]=self["webpackChunkvue_arcgis_0905"]||[]).push([[144],{71897:function(e,t,i){i.d(t,{q:function(){return r}});var s=i(54401);class r{constructor(e,t){this._storage=new s.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,i=1){this._storage.put(this,e,t,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},54401:function(e,t,i){i.d(t,{F:function(){return o},Mn:function(){return l}});i(44114);var s=i(73405);const r=-3,a=r-1;var n;!function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"}(n||(n={}));class l{constructor(e,t,i){this.name=e,this._storage=t,this.id=h+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,i,s=0){this._storage.put(this,e,t,i,s)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t,i){this._storage.updateSize(this,e,t,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class o{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new s.A,this._users=new s.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const i=this._db.get(e.id+t);return i?.size??0}put(e,t,i,s,l){t=e.id+t;const o=this._db.get(t);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(t),o.entry!==i&&this._notifyRemove(t,o.entry,o.size,n.ALL)),s>this._maxSize)return void this._notifyRemove(t,i,s,n.ALL);if(void 0===i)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${t}`),void this._notifyRemove(t,i,0,n.ALL);const h=1+Math.max(l,a)-r;this._db.set(t,new c(i,s,h)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,t,i,s){t=e.id+t;const r=this._db.get(t);if(r&&r.entry===i){for(this._size-=r.size,e.size-=r.size;s>this._maxSize;){const e=this._notifyRemove(t,i,s,n.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);s=e}r.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,t){t=e.id+t;const i=this._db.get(t);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(e,t){t=e.id+t;const i=this._db.get(t);if(void 0!==i)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}peek(e,t){const i=this._db.get(e.id+t);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},i=new Array;this._db.forEach(((e,s)=>{const r=e.lifetime;i[r]=(i[r]||0)+e.size,this._users.forAll((i=>{const{id:r,name:a}=i;if(s.startsWith(r)){const i=t[a]||0;t[a]=i+e.size}}))}));const s={};this._users.forAll((e=>{const i=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const r=t[i]||0;t[i]=r,s[i]=Math.round(100*e.hitRate)+"%"}else s[i]="0%"}));const a=Object.keys(t);a.sort(((e,i)=>t[i]-t[e])),a.forEach((i=>e[i]=Math.round(t[i]/2**20)+"MB / "+s[i]));for(let n=i.length-1;n>=0;--n){const t=i[n];t&&(e["Priority "+(n+r-1)]=Math.round(t/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,i)=>{i.startsWith(t)&&(this._size-=e.size,this._db.delete(i),this._notifyRemove(i,e.entry,e.size,n.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,n.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,i,s){let r;return this._removeFuncs.some((a=>{if(e.startsWith(a[0])){const e=a[1](t,s,i);return"number"==typeof e&&(r=e),!0}return!1})),r}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const i=e?.id;let s=!0;for(;s;){s=!1;for(const[r,a]of this._db)if(0===a.lifetime&&(!i||r.startsWith(i))){if(this._purgeItem(r,a,e),t.size<=.9*t.maxSize)return;s||=this._db.has(r)}}for(const[r,a]of this._db)if((!i||r.startsWith(i))&&(this._purgeItem(r,a,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,i=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,i&&(i.size-=t.size);const s=this._notifyRemove(e,t.entry,t.size,n.SOME);null!=s&&s>0&&(this._size+=s,i&&(i.size+=s),t.lives=t.lifetime,t.size=s,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}let h=0;class c{constructor(e,t,i){this.entry=e,this.size=t,this.lifetime=i,this.lives=i}}},20144:function(e,t,i){i.d(t,{f:function(){return u}});var s=i(40399),r=(i(32334),i(36861)),a=(i(9302),i(8660),i(95753),i(29811)),n=i(39834),l=i(12275),o=i(96683),h=i(27159),c=i(70616);const u=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}destroy(){this.tilemapCache?.destroy?.()}readMinScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}readMaxScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,t,i){const s=t.capabilities?.includes("Tilemap");let{minLOD:r,maxLOD:a,minScale:n,maxScale:c}=t;if(null==r&&null==a&&0!==n&&0!==c){const e=e=>Math.round(1e4*e)/1e4;n=e(n||t.tileInfo.lods[0].scale),c=e(c||t.tileInfo.lods[t.tileInfo.lods.length-1].scale);for(const i of t.tileInfo.lods){const t=e(i.scale);r=t>=n?i.level:r,a=t>=c?i.level:a}}if(s)return new h.d({layer:this,minLOD:r,maxLOD:a});if(t.tileInfo){const e=new l.A;return e.read(t.tileInfo,i),new o.A(e,r,a)}return null}};return(0,s._)([(0,r.MZ)({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),(0,s._)([(0,r.MZ)()],t.prototype,"minScale",void 0),(0,s._)([(0,a.w)("service","minScale")],t.prototype,"readMinScale",null),(0,s._)([(0,r.MZ)()],t.prototype,"maxScale",void 0),(0,s._)([(0,a.w)("service","maxScale")],t.prototype,"readMaxScale",null),(0,s._)([(0,r.MZ)({type:c.A})],t.prototype,"spatialReference",void 0),(0,s._)([(0,r.MZ)({readOnly:!0})],t.prototype,"supportsBlankTile",null),(0,s._)([(0,r.MZ)({type:l.A})],t.prototype,"tileInfo",void 0),(0,s._)([(0,r.MZ)()],t.prototype,"tilemapCache",void 0),(0,s._)([(0,a.w)("service","tilemapCache",["capabilities","tileInfo"])],t.prototype,"readTilemapCache",null),(0,s._)([(0,r.MZ)()],t.prototype,"version",void 0),t=(0,s._)([(0,n.$)("esri.layers.mixins.ArcGISCachedService")],t),t}},96683:function(e,t,i){i.d(t,{A:function(){return a}});var s=i(18244),r=i(13570);class a{constructor(e,t=0,i=e.lods[e.lods.length-1].level){this.tileInfo=e,this.minLOD=t,this.maxLOD=i,e.lodAt(t)||(this.minLOD=e.lods[0].level),e.lodAt(i)||(this.maxLOD=e.lods[e.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(e,t,i){const s=this.tileInfo?.lodAt(e);return!s||e<this.minLOD||e>this.maxLOD?"unavailable":s.cols&&s.rows?i>=s.cols[0]&&i<=s.cols[1]&&t>=s.rows[0]&&t<=s.rows[1]?"unknown":"unavailable":"unknown"}async fetchAvailability(e,t,i,a){await(0,r.NO)(a);const n=this.getAvailability(e,t,i);if("unavailable"===n)throw new s.A("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return n}async fetchAvailabilityUpsample(e,t,i,s,a){await(0,r.NO)(a),s.level=e,s.row=t,s.col=i;const n=this.tileInfo;return n.updateTileInfo(s),this.fetchAvailability(e,t,i,a).catch((e=>{if((0,r.zf)(e))throw e;if(n.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,a);throw e}))}}},27159:function(e,t,i){i.d(t,{d:function(){return L}});i(44114);var s,r=i(40399),a=i(5049),n=i(13592),l=i(78749),o=i(18244),h=i(29245),c=(i(9302),i(71897)),u=i(73405),f=i(13570),m=i(78574),_=i(37618),d=i(94),p=i(36861),v=(i(8660),i(95753),i(39834)),g=i(51492),y=i(38308),z=i(22721);i(16573),i(78100),i(77936),i(37467),i(44732),i(79577);function b(e,t=!1){return e<=z.y9?t?new Array(e).fill(0):new Array(e):new Uint32Array(e)}class w{constructor(e){x(e);const{location:t,data:i}=e;this.location=Object.freeze((0,y.o8)(t));const s=this.location.width,r=this.location.height;let a=!0,n=!0;const l=Math.ceil(s*r/32),o=b(l);let h=0;for(let c=0;c<i.length;c++){const e=c%32;i[c]?(n=!1,o[h]|=1<<e):a=!1,31===e&&++h}n?(this._availability="unavailable",this.byteSize=40):a?(this._availability="available",this.byteSize=40):(this._availability=o,this.byteSize=40+(0,z.Ek)(o))}getAvailability(e,t){if("unavailable"===this._availability||"available"===this._availability)return this._availability;const i=(e-this.location.top)*this.location.width+(t-this.location.left),s=i%32,r=i>>5,a=this._availability;return r<0||r>a.length?"unknown":a[r]&1<<s?"available":"unavailable"}static fromDefinition(e,t){const i=e.service.request||a.A,{row:s,col:r,width:n,height:l}=e,h={query:{f:"json"}};return t=t?{...h,...t}:h,i(S(e),t).then((e=>e.data)).catch((e=>{if(422===e?.details?.httpStatus)return{location:{top:s,left:r,width:n,height:l},valid:!0,data:new Array(n*l).fill(0)};throw e})).then((e=>{if(e.location&&(e.location.top!==s||e.location.left!==r||e.location.width!==n||e.location.height!==l))throw new o.A("tilemap:location-mismatch","Tilemap response for different location than requested",{response:e,definition:{top:s,left:r,width:n,height:l}});return w.fromJSON(e)}))}static fromJSON(e){return Object.freeze(new w(e))}}function A(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}function S(e){let t;if(e.service.tileServers?.length){const i=e.service.tileServers;t=`${i&&i.length?i[e.row%i.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}else t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;const i=e.service.query;return i&&(t=`${t}?${i}`),t}function x(e){if(!e?.location)throw new o.A("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new o.A("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new o.A("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new o.A("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new o.A("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}let L=s=class extends n.A{constructor(e){super(e),this._pendingTilemapRequests={},this.request=a.A,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new c.q(2*l.u.MEGABYTES),this.addHandles((0,m.wB)((()=>{const{layer:e}=this;return[e?.parsedUrl,e?.tileServers,e?.apiKey,e?.customParameters]}),(()=>this._initializeTilemapDefinition()),m.Vh))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(e,t,i){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return"unavailable";const s=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return s?s.getAvailability(t,i):"unknown"}fetchAvailability(e,t,i,s){return!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD?Promise.reject(new o.A("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):this._fetchTilemap(e,t,i,s).catch((e=>e)).then((s=>{if(s instanceof w){const r=s.getAvailability(t,i);if("unavailable"===r)throw new o.A("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return r}if((0,f.zf)(s))throw s;return"unknown"}))}fetchAvailabilityUpsample(e,t,i,s,r){s.level=e,s.row=t,s.col=i;const a=this.layer.tileInfo;a.updateTileInfo(s);const n=this.fetchAvailability(e,t,i,r).catch((e=>{if((0,f.zf)(e))throw e;if(a.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(s.id,e,t,i,r,n),n}async _fetchAvailabilityUpsamplePrefetch(e,t,i,r,a,n){if(!this._prefetchingEnabled||null==e)return;const l=`prefetch-${e}`;if(this.hasHandles(l))return;const o=new AbortController;n.then((()=>o.abort()),(()=>o.abort()));let c=!1;const u=(0,h.hA)((()=>{c||(c=!0,o.abort())}));if(this.addHandles(u,l),await(0,_.md)(10,o.signal).catch((()=>{})),c||(c=!0,this.removeHandles(l)),(0,f.G4)(o))return;const m=new g.U(e,t,i,r),d={...a,signal:o.signal},p=this.layer.tileInfo;for(let h=0;s._prefetches.length<s._maxPrefetch&&p.upsampleTile(m);++h){const e=this.fetchAvailability(m.level,m.row,m.col,d);s._prefetches.push(e);const t=()=>{s._prefetches.removeUnordered(e)};e.then(t,t)}}_fetchTilemap(e,t,i,s){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return Promise.reject(new o.A("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const r=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,t,i,r);if(a)return Promise.resolve(a);const n=s?.signal;return s={...s,signal:null},new Promise(((e,t)=>{(0,f.u7)(n,(()=>t((0,f.NK)())));const i=A(r);let a=this._pendingTilemapRequests[i];if(!a){a=w.fromDefinition(r,s).then((e=>(this._tilemapCache.put(i,e,e.byteSize),e)));const e=()=>{delete this._pendingTilemapRequests[i]};this._pendingTilemapRequests[i]=a,a.then(e,e)}a.then(e,t)}))}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const{parsedUrl:e,apiKey:t,customParameters:i}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:(0,d.x0)({...e.query,...i,token:t??e.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,s){s.level=e,s.row=t-t%this.size,s.col=i-i%this.size;const r=A(s);return this._tilemapCache.get(r)}get test(){}};L._maxPrefetch=4,L._prefetches=new u.A({initialSize:s._maxPrefetch}),(0,r._)([(0,p.MZ)({constructOnly:!0})],L.prototype,"layer",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],L.prototype,"minLOD",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],L.prototype,"maxLOD",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],L.prototype,"request",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],L.prototype,"size",void 0),L=s=(0,r._)([(0,v.$)("esri.layers.support.TilemapCache")],L)}}]);
//# sourceMappingURL=144.f601835a.js.map